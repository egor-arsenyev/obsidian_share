Прежде чем зарегистрировать домен, если задачей является получение доступа через интернет к сервисам, развернутым, например, на виртуальной машине, запущенной на ПК, необходимо убедиться, что провайдер предоставляет [[Белые и серые IP-адреса#Белый (публичный) IP-адрес|белый]] IP-адрес для выхода в сеть.

Если провайдер предоставляет IP-адрес из диапазона [[Белые и серые IP-адреса#Серый (частный) IP-адрес|серых]] адресов, то доступ к устройствам и сервисам, размещенным в локальной сети получить не получится.

Регистрацией доменного имени занимаются [[Регистраторы доменных имен]]. Для практического примера воспользуемся услугами reg.ru

**Заказать домен** -> 

-> **Зарегистрировать домен**  **->**
	необходимо ввести желаемое имя домена, далее рег.ру предложит доступные варианты. Например myname-iot, рег.ру предложит варианты в том числе myname-iot.ru.
	**.ru** - это домен (доменная зона) первого уровня, желаемое название - домен второго уровня.

-> **Заполнить контактные данные ->**
	Необходимо, чтобы в случае непредвиденных обстоятельств подтвердить свое право владения доменом (можно заполнить дефолтными данными из примера заполнения, указав только верный телефон и e-mail)

-> **Оплатить ->**

-> **Готово** 

После оплаты во вкладке "Домены" появится зарегистрированный домен.
**НО** совершать какие-либо действия с данным доменом через интернет можно будет совершать только через 24 часа (домен прогрузится на всех DNS-серверах). По прошествии данного срока можно начинать работу, добавление доменных записей будет происходить через 5-15 минут после внесения.

### Cоздание доменных записей

##### Добавление [[DNS-записи#^2572aa|A]] записи

Во вкладке "Домены" **выбираем зарегистрированный нами домен** ->

-> **Изменить** -> 

-> **Добавить запись** -> 

-> **Тип записи А** -> 

-> **Subdomain** ->
	домен третьего уровня, который будет использоваться при обращении к какому-либо сервису по данному имени.

-> **IP Addres** ->
	белый IP адрес, предоставленный провайдером (можно узнать в веб-конфигураторе роутера)

-> **Готово**

##### Добавление [[DNS-записи#^b86651|CNAME]] записи

Во вкладке "Домены" **выбираем зарегистрированный нами домен** ->

-> **Изменить** -> 

-> **Добавить запись** -> 

-> **Тип записи CNAME** -> 
	Запись CNAME создает псевдоним для домена, перенаправляя запросы на другой домен.  Если провайдер выдает **динамический** белый IP, то чтобы не заниматься ручным обновлением IP-адреса, можно создать CNAME запись и сослаться на другой домен, который будет принадлежать DDNS сервису. DDNS сервис будет обновлять связку записи CNAME и текущего IP-адреса. Для этого необходимо [[Создание домена в сервисе DDNS|Создать домен в сервисе DDNS]]
-> **Canonical name** - указываем домен, зарегистрированный на DDNS сервисе (aemdeviot021.ddns.net)
-> **Subdomain** 
	Имя сервиса, например graafana (grafana-aem-021)

Аналогично можно сделать подобные записи для других сервисов (influxdb, nodered, wireguard, mqtt).

 Практическая идея:
	 При обращении по адресу grafana-aem-021.dev-iot.ru мы по идее должны получить IP-адрес, но в CNAME у нас указан не IP, а другое доменное имя. Следовательно при попытке обращения к grafana-aem-021.dev-iot.ru мы обратимся к aemdeviot021.ddns.net, где будет располагаться динамически обновляемая [[DNS-записи#^2572aa|A]]-запись.

В принципе этап регистрации домена на DDNS сервисе можно упразднить, т.к. практически у каждого регистратора доменных имен есть API, которое позволяет через запросы обновлять IP-адрес для А-записи. Т.е. можно написать скрипт, который будет работать с рег.ру по API, и обновлять IP в А-записи.

##### Проверка

Чтобы проверить что доменные записи обновились и с ними можно работать через интернет:

копируем в буфер адрес домена (например aem-021.dev-iot.ru)-> переходим по https://www.reg.ru/nettools/dig ->Заполняем поле домен -> Результат:

| Домен               | TTL   | Тип | Результат                                        | Ответ от сервера  |
| ------------------- | ----- | --- | ------------------------------------------------ | ----------------- |
| aem-021.dev-iot.ru. | 21600 | A   | 85.21.144.63  <br>85-21-144-63.static.corbina.ru | 8.8.8.8 (71 msec) |
Это говорит, что при обращении к доменному имени уже существует и обрабатывается запись типа А и возвращает IP-адрес (ответ от DNS-сервера google 8.8.8.8)

Запрос: **dig grafana-aem-021.dev-iot.ru any**

Ответ:

|Домен|TTL|Тип|Результат|Ответ от сервера|
|---|---|---|---|---|
|grafana-aem-021.dev-iot.ru.|21600|CNAME|aemdeviot021.ddns.net|8.8.8.8 (66 msec)|
