**MQTT (Message Queuing Telemetry Transport)** — это облегчённый протокол обмена сообщениями, разработанный для устройств с ограниченными ресурсами и работы в сетях с нестабильным соединением. Он широко используется в IoT (Интернете вещей), умных домах, промышленной автоматизации и других сферах, где важна эффективная передача данных.

### Основные особенности MQTT:

Обмен данными по протоколу MQTT (Message Queuing Telemetry Transport) основан на модели **«издатель-подписчик»** и предназначен для эффективной передачи сообщений между устройствами, особенно в условиях ограниченных ресурсов (например, в IoT). MQTT представляет [[Push и Pull модели предоставления данных|Push]] модель предоставления данных. Вот как это работает:

---

### 1. **Основные компоненты**

- **Брокер (Broker)**: Центральный сервер, который управляет подключениями клиентов, принимает сообщения от издателей и распределяет их подписчикам.
    
- **Клиенты (Clients)**: Устройства или приложения, которые могут быть:
    
    - **Издателями (Publishers)**: Отправляют сообщения в определенные темы (топики).
        
    - **Подписчиками (Subscribers)**: Получают сообщения из тем, на которые подписаны.
        

---

### 2. **Топики (Topics)**

- **Топик** — это строка, определяющая канал для обмена данными (например, `home/kitchen/temperature`).
     ^3d7213
- **Иерархическая структура**: Топики разделяются слешами (`/`), что позволяет группировать данные (например, `sensors/+/status`).
    
- **Wildcards**:
    
    - `+` — заменяет один уровень в топике (например, `home/+/light` подходит для `home/livingroom/light` и `home/garage/light`).
        
    - `#` — многоуровневый wildcard (например, `sensors/#` включает все подтопики внутри `sensors`).
        

---

### 3. **Этапы обмена данными**

1. **Установка соединения**:
    
    - Клиент подключается к брокеру через [[TCP_IP|TCP/IP]] (порт 1883) или с шифрованием через TLS (порт 8883).
        
    - При подключении клиент может передать логин/пароль, идентификатор (Client ID) и параметры (например, Last Will).
        
2. **Подписка (Subscribe)**:
    
    - Подписчик отправляет брокеру запрос на подписку к определенному топику (или нескольким).
        
    - Брокер сохраняет информацию о подписках.
        
3. **Публикация (Publish)**:
    
    - Издатель отправляет сообщение в топик через брокер.
        
    - Брокер перенаправляет сообщение всем клиентам, подписанным на этот топик.
        
4. **Доставка сообщений**:
    
    - В зависимости от уровня QoS (см. ниже) брокер гарантирует доставку сообщения.
        

---

### 4. **Уровни QoS (Quality of Service)**

MQTT поддерживает три уровня надежности доставки:

- **QoS 0 (At most once)**: Сообщение отправляется однократно без подтверждения. Возможна потеря данных.
    
- **QoS 1 (At least once)**: Брокер и клиент подтверждают доставку. Сообщение может быть доставлено несколько раз.
    
- **QoS 2 (Exactly once)**: Гарантирует однократную доставку через четырехэтапное подтверждение (handshake).
    

---

### 5. **Дополнительные функции**

- **Retained Messages**:
    
    - Брокер сохраняет последнее сообщение в топике и отправляет его новым подписчикам сразу после подписки.
        
    - Полезно для передачи текущего состояния устройства (например, температуры).
        
- **Last Will and Testament (LWT)**:
    
    - Клиент при подключении указывает сообщение, которое брокер отправит в заданный топик, если клиент отключится аварийно.
        
- **Persistent Sessions**:
    
    - Брокер сохраняет подписки и неподтвержденные сообщения для клиента, если он переподключается с флагом `cleanSession=false`.
        

---

### 6. **Безопасность**

- **Аутентификация**: Логин/пароль или сертификаты TLS.
    
- **Шифрование**: TLS/SSL для защиты данных в сети.
    
- **Контроль доступа**: ACL (Access Control Lists) для ограничения прав клиентов на публикацию/подписку.
    

---

### 7. **Преимущества MQTT**

- Легковесный: Минимальные накладные расходы (заголовок сообщения — всего 2 байта).
    
- Эффективен в слабых сетях: Поддержка QoS и устойчивость к разрывам.
    
- Масштабируемость: Подходит для тысяч устройств.
    

---

### Пример сценария (Умный дом)

1. Датчик температуры (`publisher`) публикует данные в топик `home/kitchen/temp` с QoS 1.
    
2. Брокер принимает сообщение и отправляет его всем подписчикам топика.
    
3. Устройство управления отоплением (`subscriber`) получает данные и регулирует температуру.
    
4. Если датчик отключается, брокер отправляет LWT-сообщение в `home/kitchen/status`, уведомляя об ошибке.
    

### История:

Протокол создан в 1999 году компаниями IBM и Arcom (сейчас Eurotech) для мониторинга нефтепроводов. С 2014 года стандартизирован организацией **OASIS**.

### Популярные брокеры:

- Mosquitto (открытый исходный код),
    
- HiveMQ,
    
- AWS IoT Core,
    
- EMQX.
    

MQTT идеален для сценариев, где важна простота, низкое энергопотребление и эффективная работа в нестабильных сетях.