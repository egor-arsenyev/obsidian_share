
**DHCP** – Dynamic Host Configuration Protocol — клиент-серверный протокол динамической настройки узла, позволяет узлам сети автоматически получать различные параметры, называемые опциями: [[IP-адрес]], IP-адрес шлюза по умолчанию, IP-адрес DNS сервера.
Без DHCP пришлось бы использовать ручное распределение. Администратору сети пришлось бы в ручную заходит на DHCP сервер и присваивать устройствам IP-адреса локальной сети на основании их [[MAC-адрес|MAC-адресов]].

![[Pasted image 20250329195516.png|500]]
#### Как работает DHCP?

1. **Обнаружение (Discover)**:  
    Устройство (клиент) при подключении отправляет широковещательный запрос `DHCPDISCOVER` в поисках сервера.
2. **Предложение (Offer)**:  
    DHCP-сервер отвечает `DHCPOFFER`, предлагая свободный IP-адрес, маску подсети, шлюз и другие настройки.
3. **Запрос (Request)**:  
    Клиент подтверждает выбор, отправляя `DHCPREQUEST`, чтобы закрепить адрес за собой.
4. **Подтверждение (Acknowledgment)**:  
    Сервер фиксирует выделение адреса через `DHCPACK`. Теперь устройство может работать в сети.

#### Основные компоненты

- **Сервер**: Управляет пулом IP-адресов и настройками (DNS, шлюз и т.д.).
- **Клиент**: Устройство, запрашивающее настройки (ПК, смартфон, принтер).
- **Ретранслятор (Relay)**: Пересылает запросы между подсетями, если сервер находится в другой сети.

#### Аренда адресов

- Каждому адресу назначается **срок аренды** (например, 24 часа). Клиент может запросить продление.
- Если устройство отключается, адрес возвращается в пул после истечения срока.

#### Преимущества

- **Автоматизация**: Нет нужды вручную настраивать каждое устройство.
- **Гибкость**: Динамическое распределение адресов подходит для сетей с меняющимся числом устройств.
- **Минимизация ошибок**: Исключает конфликты IP-адресов.

#### Настройка

- **Домашние маршрутизаторы**: Имеют встроенный DHCP-сервер. Настройки включают диапазон адресов (например, 192.168.1.100–200), шлюз и DNS.
- **Корпоративные сети**: Используют выделенные серверы (Windows Server, Linux с `isc-dhcp-server`), где можно настроить резервирование (статический IP для MAC-адреса), разные подсети и т.д.

#### Особенности для IPv6

- В IPv6 используется **DHCPv6**, но есть альтернативы (SLAAC). Основные принципы схожи, но добавляется поддержка длинных адресов и новых параметров.

#### Недостатки

- **Зависимость от сервера**: Его отказ блокирует подключение новых устройств.
- **Безопасность**: В публичных сетях DHCP-спуфинг может перенаправлять трафик (решается через защиту портов, DHCP Snooping).
#### Пример резервирования
Серверу или принтеру можно закрепить постоянный IP через привязку к MAC-адресу:
```
host Printer {
  hardware ethernet 00:1A:2B:3C:4D:5E;
  fixed-address 192.168.1.50;
}
```
